---
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git log:*), Bash(git add:*), Bash(git commit:*), Bash(gh pr view:*), Bash(gh pr comment:*), Bash(gh api:*)
description: CodeRabbitのレビューコメントを読み取り、修正の妥当性を判断して修正を適用し、コメントで報告する
argument-hint: [pr-number]
---

# レビューフィードバック対応コマンド

CodeRabbitのレビューコメントを読み取り、修正の妥当性を深く考え、必要に応じて修正を適用し、コメントで報告します。

## 現在の状況

### Git ステータス

!`git status --porcelain`

### 現在のブランチ

!`git branch --show-current`

### 指定されたPRの詳細

!`if [ -n "$ARGUMENTS" ]; then gh pr view $ARGUMENTS; else echo "PR番号が指定されていません。現在のブランチのPRを自動検出します"; fi`

### PRのコメント一覧

!`if [ -n "$ARGUMENTS" ]; then gh pr view $ARGUMENTS --comments; else gh pr list --head $(git branch --show-current) --json number --jq '.[0].number' | xargs -I {} gh pr view {} --comments; fi`

### PRのディスカッション（レビューコメント）

!`if [ -n "$ARGUMENTS" ]; then gh api repos/:owner/:repo/pulls/$ARGUMENTS/comments; else gh pr list --head $(git branch --show-current) --json number --jq '.[0].number' | xargs -I {} gh api repos/:owner/:repo/pulls/{}/comments; fi`

## あなたのタスク

上記の情報を基に、以下の手順でレビューフィードバックに対応してください：

### 1. **コメントとディスカッションの読み取り**

- PRのコメント一覧を確認
- CodeRabbitからのレビューコメントを特定
- ディスカッション（具体的なコードレビュー）を確認
- 「Prompt for AI Agents」を含むコメントを特定

### 2. **修正の妥当性の深い検討**

各レビューコメントについて以下を検討：

- **技術的正確性**: 指摘された問題は実際に存在するか？
- **影響範囲**: 修正による影響は適切か？
- **設計思想**: 現在の設計意図と矛盾しないか？
- **優先度**: Critical、Major、Minorの分類は適切か？
- **代替案**: より良い解決策はないか？

### 3. **修正の適用**

#### 3.1. **Prompt for AI Agentsがある場合**

- プロンプトの内容を正確に理解
- プロンプトに従って修正を適用
- プロンプトの意図を尊重

#### 3.2. **その他の修正**

- 技術的に妥当と判断された修正のみ適用
- 影響範囲を最小限に抑制
- 既存のテストが壊れないことを確認

### 4. **非ソースコードファイルの修正**

修正に伴い更新が必要なファイル：

- **ドキュメント**: README、設計書、API仕様書
- **設定ファイル**: go.mod、Dockerfile、Makefile
- **テストファイル**: テストケースの追加・修正
- **CI/CD**: GitHub Actions、デプロイスクリプト

### 5. **コメントでの報告**

#### 5.1. **修正した箇所**

以下の形式でコメントを投稿：

```markdown
## 🔧 修正対応完了

### 修正内容

- **ファイル**: `path/to/file.go`
- **問題**: [CodeRabbitの指摘内容]
- **修正**: [具体的な修正内容]
- **理由**: [修正の妥当性と理由]

### 影響範囲

- [修正による影響の説明]
- [テスト結果の確認]

### 関連ファイルの更新

- [更新した非ソースコードファイルの一覧]
```

#### 5.2. **修正しなかった箇所**

以下の形式でコメントを投稿：

```markdown
## 🤔 修正を見送りました

### 見送り理由

- **ファイル**: `path/to/file.go`
- **指摘内容**: [CodeRabbitの指摘内容]
- **見送り理由**: [修正しない判断の根拠]
- **代替案**: [将来的な改善案があれば]

### 技術的判断

- [設計思想との整合性]
- [影響範囲の考慮]
- [優先度の評価]
```

## 実行例

```bash
# 特定のPRのレビューフィードバックに対応
/review-feedback 1

# 現在のブランチのPRのレビューフィードバックに対応
/review-feedback
```

## 修正の判断基準

### ✅ **修正すべき項目**

- **Critical**: セキュリティ問題、データ損失の可能性
- **Major**: 機能障害、パフォーマンス問題
- **Minor**: コード品質、保守性の向上（影響範囲が小さい場合）

### ❌ **修正を見送る項目**

- 設計思想と矛盾する提案
- 影響範囲が大きすぎる修正
- 現在の要件に不要な機能追加
- テストカバレッジが不十分な修正

## エラーハンドリング

- **PRが存在しない場合**: エラーメッセージを表示
- **レビューコメントがない場合**: 確認メッセージを表示
- **修正に失敗した場合**: エラー内容をコメントで報告
- **コミットに失敗した場合**: 詳細なエラー情報を提供

## 注意事項

- 修正前に必ず現在のコードをバックアップ
- 修正後は必ずテストを実行
- コミットメッセージは修正内容を明確に記述
- コメントは技術的に正確で建設的な内容にする
- 引数として提供されたPR番号を使用：$ARGUMENTS

## 成功時の出力

修正完了後に以下を表示：

- 修正したファイル数と内容
- 投稿したコメントのURL
- 次のステップの提案

--- End Command ---
