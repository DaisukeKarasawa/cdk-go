---
allowed-tools: Bash(git status:*), Bash(git diff:*), Bash(git log:*), Bash(gh pr list:*), Bash(gh pr view:*), Bash(gh pr edit:*)
description: 既存PRのタイトルと説明を現在のコミット内容に基づいて更新する
argument-hint: [pr-number]
---

# PR更新コマンド

既存のPull Requestのタイトルと説明を、現在のコミット内容に基づいて更新します。

## 現在の状況

### 現在のブランチのPR一覧

!`gh pr list --head $(git branch --show-current)`

### 指定されたPRの詳細（引数がある場合）

!`if [ -n "$ARGUMENTS" ]; then gh pr view $ARGUMENTS; else echo "PR番号が指定されていません"; fi`

### Git ステータス

!`git status --porcelain`

### 現在のブランチ

!`git branch --show-current`

### コミット履歴（現在のブランチ vs master）

!`git log --oneline master..HEAD --format="%h %s"`

### 変更差分の統計

!`git diff master..HEAD --stat`

### 変更されたファイルの詳細

!`git diff master..HEAD --name-status`

## あなたのタスク

上記の情報を基に、以下の手順でPRを更新してください：

1. **PR番号の特定**：

   - 引数でPR番号が指定されている場合はそれを使用：$ARGUMENTS
   - 指定されていない場合は、現在のブランチに関連するPRを自動検出
   - 複数のPRがある場合は、最新のものを選択

2. **変更内容の分析**：

   - 変更されたファイルの種類と内容を確認
   - 変更の性質（新機能、バグ修正、リファクタリングなど）を判断
   - 既存のPRタイトル・説明と比較して更新が必要かを判断

3. **適切なタイトルの生成**：

   - Conventional Commitsの形式に従う
   - `feat:` - 新機能の追加
   - `fix:` - バグ修正
   - `docs:` - ドキュメントの変更
   - `style:` - コードスタイルやフォーマットの修正
   - `refactor:` - コードのリファクタリング
   - `test:` - テストの追加や修正
   - `chore:` - ビルドプロセスや補助ツールの変更
   - `perf:` - パフォーマンス改善
   - `ci:` - CI/CD関連の変更

4. **詳細な説明の更新**：

   - ## 概要 - 変更の目的と背景
   - ## 変更内容 - 具体的な変更点（最新の状態を反映）
   - ## 技術的詳細 - 実装の詳細（必要に応じて）
   - ## 動作確認 - テスト内容や確認事項
   - ## 影響範囲 - 既存機能への影響
   - ## 次のステップ - 後続作業（必要に応じて）
   - ## 更新履歴 - 主要な変更点（既存の説明に追記）

5. **PRの更新**：
   - 生成したタイトルと説明でPRを更新
   - 更新されたPRのURLを表示

## 実行例

```bash
# 現在のブランチのPRを確認
gh pr list --head $(git branch --show-current)

# 特定のPRを更新
gh pr edit 1 --title "新しいタイトル" --body "更新された説明"

# 更新されたPRを確認
gh pr view 1
```

## 注意事項

- 更新前に必ず現在のPRの内容を確認してください
- 既存の説明に重要な情報がある場合は、それを保持してください
- タイトルは50文字以内で簡潔にまとめてください
- 説明は将来の開発者（自分を含む）が理解しやすいように書いてください
- 引数として特定のPR番号が提供された場合は、それを使用してください：$ARGUMENTS

## PR番号の指定

引数でPR番号を指定できます：

```bash
# 現在のブランチのPRを自動検出して更新
/update-pr

# 特定のPR番号を指定して更新
/update-pr 1

# 別のPR番号を指定
/update-pr 42
```

## エラーハンドリング

- 指定されたPRが存在しない場合は、エラーメッセージを表示
- 現在のブランチにPRが存在しない場合は、PR作成を提案
- 権限がない場合は、適切なエラーメッセージを表示
- 変更がない場合は、更新の必要性を確認

## 更新戦略

- **タイトル**: 最新のコミット内容を反映して完全に更新
- **説明**: 既存の重要な情報を保持しつつ、新しい変更内容を追加
- **ラベル**: 変更の性質に応じて適切なラベルを提案（手動設定）

--- End Command ---
